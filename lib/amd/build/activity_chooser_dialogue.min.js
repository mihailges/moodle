define ("core/activity_chooser_dialogue",["jquery","core/activity_chooser_events","core/local/aria/focuslock","core/modal_factory","core/modal_events"],function(a,b,c,d,e){var f=null,g=[],h=null,i=null,j={minheight:300,baseheight:400,maxheight:660,closeButtonTitle:{validator:Y.Lang.isString,value:"Close"}},k=function(){var b;while(g.length){b=g.shift();a(b).off()}},l=function(){k();null.off();f.hide()},m={CHOOSER_CONTAINER:"[data-region=\"chooser-container\"]",CHOOSER_OPTIONS_CONTAINER:"[data-region=\"chooser-options-container\"]",CHOOSER_OPTION_CONTAINER:"[data-region=\"chooser-option-container\"]",CHOOSER_OPTION_ACTIONS_CONTAINER:"[data-region=\"chooser-option-actions-container\"]",CHOOSER_OPTION_INFO_CONTAINER:"[data-region=\"chooser-option-info-container\"]",CHOOSER_OPTION_SUMMARY_CONTAINER:"[data-region=\"chooser-option-summary-container\"]",CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER:"[data-region=\"chooser-option-summary-content-container\"]",CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER:"[data-region=\"chooser-option-summary-actions-container\"]",CHOOSER_OPTION_ACTION_GROUP_ELEMENT:"[data-group=\"chooser-option-action\"]",CHOOSER_OPTION_ACTIONS:{SHOW_CHOOSER_OPTION_SUMMARY:"[data-action=\"show-option-summary\"]"},ADD_CHOOSER_OPTION:"[data-action=\"add-chooser-option\"]",CLOSE_CHOOSER_OPTION_SUMMARY:"[data-action=\"close-chooser-option-summary\"]"},n=function(){var b=a(m.CHOOSER_OPTION_ACTIONS.SHOW_CHOOSER_OPTION_SUMMARY).on("click",function(b){var c=a(b.target).closest(m.CHOOSER_OPTION_CONTAINER).find(m.CHOOSER_OPTION_SUMMARY_CONTAINER);p(c)});g.push(b);b=a(m.CLOSE_CHOOSER_OPTION_SUMMARY).on("click",function(b){var c=a(b.target).closest(m.CHOOSER_OPTION_CONTAINER).find(m.CHOOSER_OPTION_SUMMARY_CONTAINER);c.removeClass("open");a(m.CHOOSER_CONTAINER).removeClass("noscroll")});g.push(b);b=a(m.CHOOSER_OPTION_CONTAINER).on("keydown",function(b){var c=a(this).index(),d=a(m.CHOOSER_OPTION_CONTAINER).outerWidth(),e=a(m.CHOOSER_OPTIONS_CONTAINER).width(),f=Math.floor(e/d),g=a(m.CHOOSER_OPTIONS_CONTAINER).find(m.CHOOSER_OPTION_CONTAINER),h=g.length,i=Math.ceil(h/f),j=Math.ceil((c+1)/f);if(39===b.keyCode){var k=c+1;if("undefined"==typeof g[k]){return}r(g[c],g[k])}if(37===b.keyCode){var l=c-1;if("undefined"==typeof g[l]){return}r(g[c],g[l])}if(40===b.keyCode){if(j==i){return}var k=c+f;if("undefined"==typeof g[k]){k=h-1}r(g[c],g[k])}if(38===b.keyCode){if(1===j){return}var l=c-f;if("undefined"==typeof g[l]){l=0}r(g[c],g[l])}if(35===b.keyCode){var n=h-1;if(c===n){return}r(g[c],g[n])}if(36===b.keyCode){if(c===0){return}r(g[c],g[0])}if(13===b.keyCode||32==b.keyCode){Object.values(m.CHOOSER_OPTION_ACTIONS).forEach(function(b){a(b).attr("tabindex",0)});var o=a(this).find(m.ADD_CHOOSER_OPTION);a(o).focus();a(this).attr("tabindex",-1)}});g.push(b);b=a(m.CHOOSER_OPTION_ACTION_GROUP_ELEMENT).on("keydown",function(b){b.preventDefault();b.stopPropagation();var c=a(this).closest(m.CHOOSER_OPTION_ACTIONS_CONTAINER).find(m.CHOOSER_OPTION_ACTION_GROUP_ELEMENT);console.log(this);console.log(c);var d=c.index(this);if(27===b.keyCode){var e=a(this).closest(m.CHOOSER_OPTION_CONTAINER);a(e).attr("tabindex",0);a(e).focus();a(this).attr("tabindex",-1)}if(39===b.keyCode){var f=d+1;if("undefined"==typeof c[f]){return}r(c[d],c[f])}if(37===b.keyCode){var g=d-1;if("undefined"==typeof chooserOptions[g]){return}r(chooserOptions[d],chooserOptions[g])}if(35===b.keyCode){var h=totalChooserOptions-1;if(d===h){return}r(chooserOptions[d],chooserOptions[h])}if(36===b.keyCode){if(d===0){return}r(chooserOptions[d],chooserOptions[0])}if(13===b.keyCode){b.preventDefault();b.stopPropagation();if(a(this).parent().hasClass("showmodsummary")){var i=a(this).closest(m.MODULE_AREA).find(m.MODULE_SUMMARY_AREA);p(i)}}});g.push(b)},o=function(b){var c=h.detach();return d.create({type:d.types.DEFAULT,body:c.html(),title:i.html(),large:!0}).then(function(c){c.getRoot().on(e.shown,function(){var c=a(m.CHOOSER_OPTION_CONTAINER).find(m.ADD_CHOOSER_OPTION);c.each(function(a,c){c.href+="&section="+b});var d=a(m.CHOOSER_OPTIONS_CONTAINER).find(m.CHOOSER_OPTION_CONTAINER),e=d[0];a(e).attr("tabindex",0);var f=a(m.CHOOSER_OPTION_SUMMARY_CONTAINER).find(".helplinkpopup");f.each(function(b,c){a(c).attr("tabindex",-1)});n()}.bind(this));c.getRoot().on(e.hidden,function(){c.getRoot().remove()}.bind(this));c.show();return c})},p=function(b){var c=a(m.CHOOSER_CONTAINER).scrollTop(),d=a(m.CHOOSER_CONTAINER).outerHeight();a(m.CHOOSER_CONTAINER).addClass("noscroll");q(b,c,d);var e=b.find(m.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER);if(0<e.scrollTop()){e.scrollTop(0)}b.addClass("open");var f=b.find(m.CLOSE_CHOOSER_OPTION_SUMMARY),g=b.find(m.ADD_MODULE);a(f).attr("tabindex",0);a(g).attr("tabindex",0)},q=function(a,b,c){var d=a.find(m.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER),e=a.find(m.CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER),f=c-e.outerHeight();d.css({height:f+"px"});a.css({top:b+"px",height:c+"px"})},r=function(b,c){a(c).attr("tabindex",0);a(c).focus();a(b).attr("tabindex",-1)};return{setupChooserDialogue:function setupChooserDialogue(a,b){h=a;i=b},displayChooser:function displayChooser(a,b){o(b)}}});
//# sourceMappingURL=activity_chooser_dialogue.min.js.map
