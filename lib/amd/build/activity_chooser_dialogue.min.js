define(["core/yui","jquery","core/pubsub","core/activity_chooser_events"],function(a,b,c,d){var e=null,f=null,g=null,h=null,i=[],j=null,k=null,l=null,m=null,n={minheight:300,baseheight:400,maxheight:660,closeButtonTitle:{validator:a.Lang.isString,value:"Close"}},o=function(a,b,c){j=a,k=b,l=c},p=function(){for(var a;i.length;)a=i.shift(),b(a).off()},q=function(){p(),g.off(),e.hide()},r=function(a){a.preventDefault(),q()},s=function(a){var b="chooserdialogue-"+name,c=[];if(c.push(b.toLowerCase()),a){var d;for(d in a)c.push((b+"-"+d).toLowerCase())}return c},t=function(){if(!e){b("body").addClass("jschooser");var a,c={bodyContent:j.html(),headerContent:k.html(),width:"540px",draggable:!0,visible:!1,zindex:100,modal:!0,shim:!0,closeButtonTitle:n.closeButtonTitle,focusOnPreviousTargetAfterHide:!0,render:!1,extraClasses:s()};for(a in l)c[a]=l[a];e=new M.core.dialogue(c),j.remove(),k.remove(),e.hide(),e.render(),g=b(e.get("boundingBox").one(".choosercontainer").getDOMNode()),h=g.find(".option input[type=radio]"),m=b('<input type="hidden" value="" name=""/>'),g.find("form").append(m),e.get("boundingBox").addClass("chooserdialogue")}},u=function(a){var c,d,f=e.get("boundingBox"),g=f.get("winHeight");if(!e.shouldResizeFullscreen()){c=n.maxheight,g<=c&&(c=g<=n.minheight?n.minheight:g),c>n.minheight?e.lockScroll&&!e.lockScroll.isActive()&&e.lockScroll.enableScrollLock(!0):e.lockScroll&&e.lockScroll.isActive()&&e.lockScroll.disableScrollLock(),d=c,c-=110,b(a).css("maxHeight",c+"px");var h=f.getStyle("height");h=h.match(/.*px$/)?h.replace(/px$/,""):d,h<n.baseheight&&(h=n.baseheight,b(a).css("height",h+"px")),e.centerDialogue()}},v=function(a){27===a.keyCode&&r(a)},w=function(a,b){m.attr({value:b,name:a})},x=function(a){w(a.name,a.value),c.publish(d.OPTION_SELECTED,a)},y=function(){h.each(function(a,c){var d=b(c).parent().parent();b(this).is(":checked")?(b(d).addClass("selected"),x(c),f.removeAttr("disabled"),b(c).focus()):d.removeClass("selected")},this)},z=function(a){var c,d,j;t(),a.preventDefault(),c=e.get("boundingBox"),d=g.find(".alloptions"),j=b(document).on("orientationchange",function(){u(d)}),i.push(j),j=b(window).on("resize",function(){u(d)}),i.push(j),j=g.on("click",function(){y()}),i.push(j),j=g.on("key_up",function(){y()}),i.push(j),j=g.on("dblclick",function(a){b(a.target).parents("div.option").length&&(y(),f.attr("disabled","disabled"),h.attr("disabled","disabled"),p(),g.find("form").submit())}),i.push(j),g.find("form").on("submit",function(){f.attr("disabled","disabled"),h.attr("disabled","disabled"),p()}),j=g.find(".addcancel").on("click",function(a){r(a)}),i.push(j),j=c.one("button.closebutton").on("click",function(a){r(a)}),i.push(j),j=b(document).on("keydown",v,this),i.push(j),f=g.find(".submitbutton"),f.attr("disabled","true"),h.each(function(){b(this).removeAttr("disabled")}),e.show(a),u(d),g.find(".option input[type=radio]").focus(),y()};return{setupChooserDialogue:o,displayChooser:z,updateHiddenRadioValue:w}});