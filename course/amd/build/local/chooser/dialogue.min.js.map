{"version":3,"sources":["../../../src/local/chooser/dialogue.js"],"names":["carouselPageTo","carousel","moduleData","help","find","selectors","regions","innerHTML","then","Templates","renderForPromise","html","js","replaceNodeContents","querySelector","chooserSummary","description","focus","catch","Notification","exception","registerListenerEvents","modal","mappedModules","bodyClickListener","e","target","closest","actions","optionActions","showSummary","getBody","module","chooserOption","container","moduleName","dataset","modname","get","matches","closeOption","on","allModules","modules","caller","getModuleSelector","clearSearch","searchInput","search","value","toggleSearchResultsView","getBodyPromise","body","interval","pause","keyboard","addEventListener","chooserOptions","initKeyboardNavigation","chooserOptionsContainer","querySelectorAll","Array","from","forEach","element","keyCode","enter","space","arrowRight","currentOption","nextOption","nextElementSibling","firstOption","firstElementChild","toFocusOption","clickErrorHandler","focusChooserOption","arrowLeft","previousOption","previousElementSibling","lastOption","lastElementChild","home","end","currentChooserOption","previousChooserOption","toggleFocusableChoserOption","isFocusable","chooserOptionLink","addChooser","chooserOptionHelp","tabIndex","item","fallback","renderSearchResults","searchResultsContainer","searchResultsData","searchResultsNumber","length","templateData","modalBody","searchQuery","searchActive","searchResults","searchModules","searchResultItemsContainer","searchResultItems","firstSearchResultItem","toggleSearchResultsContainer","toggleClearSearchButton","active","clearSearchutton","style","display","setAttribute","classList","remove","removeAttribute","add","searchTerm","toLowerCase","activity","activityName","label","activityDesc","includes","push","displayChooser","origin","sectionModules","Map","set","modulename","getRoot","ModalEvents","hidden","destroy","shown","getModal","firstChooserOption","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A type of dialogue used as for choosing options.\n *\n * @module     core_course/local/chooser/dialogue\n * @package    core\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport * as ModalEvents from 'core/modal_events';\nimport selectors from 'core_course/local/chooser/selectors';\nimport * as Templates from 'core/templates';\nimport {end, arrowLeft, arrowRight, home, enter, space} from 'core/key_codes';\nimport {addIconToContainer} from 'core/loadingicon';\nimport {debounce} from 'core/utils';\n\n/**\n * Given an event from the main module 'page' navigate to it's help section via a carousel.\n *\n * @method carouselPageTo\n * @param {jQuery} carousel Our initialized carousel to manipulate\n * @param {Object} moduleData Data of the module to carousel to\n */\nconst carouselPageTo = (carousel, moduleData) => {\n    const help = carousel.find(selectors.regions.help)[0];\n    help.innerHTML = '';\n\n    addIconToContainer(help)\n\n    // Build up the html & js ready to place into the help section.\n    .then(() => {\n        return Templates.renderForPromise('core_course/chooser_help', moduleData);\n    })\n    .then(({html, js}) => Templates.replaceNodeContents(help, html, js))\n    .then(() => {\n        help.querySelector(selectors.regions.chooserSummary.description).focus();\n        return help;\n    })\n    .catch(Notification.exception);\n\n    // Trigger the transition between 'pages'.\n    carousel.carousel('next');\n};\n\n/**\n * Register chooser related event listeners.\n *\n * @method registerListenerEvents\n * @param {Promise} modal Our modal that we are working with\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n */\nconst registerListenerEvents = (modal, mappedModules) => {\n    const bodyClickListener = e => {\n        if (e.target.closest(selectors.actions.optionActions.showSummary)) {\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\n\n            const module = e.target.closest(selectors.regions.chooserOption.container);\n            const moduleName = module.dataset.modname;\n            const moduleData = mappedModules.get(moduleName);\n            carouselPageTo(carousel, moduleData);\n        }\n\n        // From the help screen go back to the module overview.\n        if (e.target.matches(selectors.actions.closeOption)) {\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\n\n            // Trigger the transition between 'pages'.\n            carousel.carousel('prev');\n            carousel.on('slid.bs.carousel', () => {\n                const allModules = modal.getBody()[0].querySelector(selectors.regions.modules);\n                const caller = allModules.querySelector(selectors.regions.getModuleSelector(e.target.dataset.modname));\n                caller.focus();\n            });\n        }\n\n        // The \"clear search\" button is triggered.\n        if (e.target.matches(selectors.actions.clearSearch)) {\n            // Clear the entered search query in the search bar and hide the search results container.\n            const searchInput = modal.getBody()[0].querySelector(selectors.actions.search);\n            searchInput.value = \"\";\n            searchInput.focus();\n            toggleSearchResultsView(modal.getBody()[0], mappedModules, searchInput.value);\n        }\n    };\n\n    modal.getBodyPromise()\n\n    // The return value of getBodyPromise is a jquery object containing the body NodeElement.\n    .then(body => body[0])\n\n    // Set up the carousel.\n    .then(body => {\n        $(body.querySelector(selectors.regions.carousel))\n            .carousel({\n                interval: false,\n                pause: true,\n                keyboard: false\n            });\n\n        return body;\n    })\n\n    // Add the listener for clicks on the body.\n    .then(body => {\n        body.addEventListener('click', bodyClickListener);\n        return body;\n    })\n\n    // Add the listener for clicks on the body.\n    .then(body => {\n        const searchInput = body.querySelector(selectors.actions.search);\n        // The search input is triggered.\n        searchInput.addEventListener('input', debounce(() => {\n            // Display the search results.\n            toggleSearchResultsView(body, mappedModules, searchInput.value);\n        }, 300));\n        return body;\n    })\n\n    // Register event listeners related to the keyboard navigation controls.\n    .then(body => {\n        const chooserOptions = body.querySelector(selectors.regions.chooserOptions);\n        initKeyboardNavigation(body, mappedModules, chooserOptions);\n        return body;\n    })\n    .catch();\n\n};\n\n/**\n * Initialise the keyboard navigation controls for the chooser.\n *\n * @method initKeyboardNavigation\n * @param {NodeElement} body Our modal that we are working with\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n * @param {HTMLElement} chooserOptionsContainer The section that contains the chooser items\n */\nconst initKeyboardNavigation = (body, mappedModules, chooserOptionsContainer) => {\n\n    const chooserOptions = chooserOptionsContainer.querySelectorAll(selectors.regions.chooserOption.container);\n\n    Array.from(chooserOptions).forEach((element) => {\n        return element.addEventListener('keyup', (e) => {\n\n            // Check for enter/ space triggers for showing the help.\n            if (e.keyCode === enter || e.keyCode === space) {\n                if (e.target.matches(selectors.actions.optionActions.showSummary)) {\n                    const module = e.target.closest(selectors.regions.chooserOption.container);\n                    const moduleName = module.dataset.modname;\n                    const moduleData = mappedModules.get(moduleName);\n                    const carousel = $(body.querySelector(selectors.regions.carousel));\n                    carousel.carousel({\n                        interval: false,\n                        pause: true,\n                        keyboard: false\n                    });\n                    carouselPageTo(carousel, moduleData);\n                }\n            }\n\n            // Next.\n            if (e.keyCode === arrowRight) {\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const nextOption = currentOption.nextElementSibling;\n                const firstOption = chooserOptionsContainer.firstElementChild;\n                const toFocusOption = clickErrorHandler(nextOption, firstOption);\n                focusChooserOption(toFocusOption, currentOption);\n            }\n\n            // Previous.\n            if (e.keyCode === arrowLeft) {\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const previousOption = currentOption.previousElementSibling;\n                const lastOption = chooserOptionsContainer.lastElementChild;\n                const toFocusOption = clickErrorHandler(previousOption, lastOption);\n                focusChooserOption(toFocusOption, currentOption);\n            }\n\n            if (e.keyCode === home) {\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const firstOption = chooserOptionsContainer.firstElementChild;\n                focusChooserOption(firstOption, currentOption);\n            }\n\n            if (e.keyCode === end) {\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const lastOption = chooserOptionsContainer.lastElementChild;\n                focusChooserOption(lastOption, currentOption);\n            }\n        });\n    });\n};\n\n/**\n * Focus on a chooser option element and remove the previous chooser element from the focus order\n *\n * @method focusChooserOption\n * @param {HTMLElement} currentChooserOption The current chooser option element that we want to focus\n * @param {HTMLElement} previousChooserOption The previous focused option element\n */\nconst focusChooserOption = (currentChooserOption, previousChooserOption = false) => {\n    if (previousChooserOption !== false) {\n        toggleFocusableChoserOption(previousChooserOption, false);\n    }\n\n    toggleFocusableChoserOption(currentChooserOption, true);\n    currentChooserOption.focus();\n};\n\n/**\n * Add or remove a chooser option from the focus order.\n *\n * @method focusChooserOption\n * @param {HTMLElement} chooserOption The chooser option element which should be added or removed from the focus order\n * @param {Boolean} isFocusable Whether the chooser element is focusable or not\n */\nconst toggleFocusableChoserOption = (chooserOption, isFocusable) => {\n    const chooserOptionLink = chooserOption.querySelector(selectors.actions.addChooser);\n    const chooserOptionHelp = chooserOption.querySelector(selectors.actions.optionActions.showSummary);\n\n    if (isFocusable) {\n        // Set tabindex to 0 to add current chooser option element to the focus order.\n        chooserOption.tabIndex = 0;\n        chooserOptionLink.tabIndex = 0;\n        chooserOptionHelp.tabIndex = 0;\n    } else {\n        // Set tabindex to -1 to remove the previous chooser option element from the focus order.\n        chooserOption.tabIndex = -1;\n        chooserOptionLink.tabIndex = -1;\n        chooserOptionHelp.tabIndex = -1;\n    }\n};\n\n/**\n * Small error handling function to make sure the navigated to object exists\n *\n * @method clickErrorHandler\n * @param {HTMLElement} item What we want to check exists\n * @param {HTMLElement} fallback If we dont match anything fallback the focus\n * @return {String}\n */\nconst clickErrorHandler = (item, fallback) => {\n    if (item !== null) {\n        return item;\n    } else {\n        return fallback;\n    }\n};\n\n/**\n * Render the search results in a defined container\n *\n * @method renderSearchResults\n * @param {HTMLElement} searchResultsContainer The container where the data should be rendered\n * @param {Object} searchResultsData Data containing the module items that satisfy the search criteria\n */\nconst renderSearchResults = async(searchResultsContainer, searchResultsData) => {\n    const searchResultsNumber = searchResultsData.length;\n    const templateData = {\n        'searchresultsnumber': searchResultsNumber,\n        'searchresults': searchResultsData\n    };\n    // Build up the html & js ready to place into the help section.\n    const {html, js} = await Templates.renderForPromise('core_course/chooser-search-results', templateData);\n    await Templates.replaceNodeContents(searchResultsContainer, html, js);\n};\n\n/**\n * Toggle (display/hide) the search results depending on the value of the search query\n *\n * @method toggleSearchResultsView\n * @param {NodeElement} modalBody The body of the created modal for the section\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n * @param {String} searchQuery The search query\n */\nconst toggleSearchResultsView = async(modalBody, mappedModules, searchQuery) => {\n    const searchActive = searchQuery.length > 0;\n    const searchResultsContainer = modalBody.querySelector(selectors.regions.searchResults);\n\n    if (searchActive) {\n        const searchResultsData = searchModules(mappedModules, searchQuery);\n        await renderSearchResults(searchResultsContainer, searchResultsData);\n        const searchResultItemsContainer = searchResultsContainer.querySelector(selectors.regions.searchResultItems);\n        const firstSearchResultItem = searchResultItemsContainer.querySelector(selectors.regions.chooserOption.container);\n        if (firstSearchResultItem) {\n            // Set the first result item to be focusable.\n            toggleFocusableChoserOption(firstSearchResultItem, true);\n            // Register keyboard events on the created search result items.\n            initKeyboardNavigation(modalBody, mappedModules, searchResultItemsContainer);\n        }\n    }\n\n    toggleSearchResultsContainer(modalBody, searchActive);\n    toggleClearSearchButton(modalBody, searchActive);\n};\n\n/**\n * Toggle (display/hide) the \"clear search\" button in the activity chooser search bar\n *\n * @method toggleClearSearchButton\n * @param {NodeElement} modalBody The body of the created modal for the section\n * @param {Boolean} active Whether the search mode is activated\n */\nconst toggleClearSearchButton = (modalBody, active) => {\n    const clearSearchutton = modalBody.querySelector(selectors.actions.clearSearch);\n    if (active) {\n        clearSearchutton.style.display = \"block\";\n    } else {\n        clearSearchutton.style.display = \"none\";\n    }\n};\n\n/**\n * Toggle (display/hide) the search results container\n *\n * @method toggleSearchResultsContainer\n * @param {NodeElement} modalBody The body of the created modal for the section\n * @param {Boolean} active Whether the search mode is activated\n */\nconst toggleSearchResultsContainer = (modalBody, active) => {\n    const searchResultsContainer = modalBody.querySelector(selectors.regions.searchResults);\n    const chooserOptionsContainer = modalBody.querySelector(selectors.regions.chooserOptions);\n\n    if (active) {\n        chooserOptionsContainer.setAttribute('hidden', 'hidden');\n        chooserOptionsContainer.classList.remove(\"d-flex\");\n        searchResultsContainer.removeAttribute('hidden');\n    } else {\n        searchResultsContainer.setAttribute('hidden', 'hidden');\n        chooserOptionsContainer.removeAttribute('hidden');\n        chooserOptionsContainer.classList.add(\"d-flex\");\n    }\n};\n\n/**\n * Return the list of modules which have a name or description that matches the given search term.\n *\n * @method searchModules\n * @param {Array} modules List of available modules\n * @param {String} searchTerm The search term to match\n * @return {Array}\n */\nconst searchModules = (modules, searchTerm) => {\n    if (searchTerm === '') {\n        return modules;\n    }\n\n    searchTerm = searchTerm.toLowerCase();\n\n    const searchResults = [];\n\n    modules.forEach((activity) => {\n        const activityName = activity.label.toLowerCase();\n        const activityDesc = activity.description.toLowerCase();\n        if (activityName.includes(searchTerm) || activityDesc.includes(searchTerm)) {\n            searchResults.push(activity);\n        }\n    });\n\n    return searchResults;\n};\n\n/**\n * Display the module chooser.\n *\n * @method displayChooser\n * @param {HTMLElement} origin The calling button\n * @param {Object} modal Our created modal for the section\n * @param {Array} sectionModules An array of all of the built module information\n */\nexport const displayChooser = (origin, modal, sectionModules) => {\n\n    // Make a map so we can quickly fetch a specific module's object for either rendering or searching.\n    const mappedModules = new Map();\n    sectionModules.forEach((module) => {\n        mappedModules.set(module.modulename, module);\n    });\n\n    // Register event listeners.\n    registerListenerEvents(modal, mappedModules);\n\n    // We want to focus on the action select when the dialog is closed.\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        modal.destroy();\n    });\n\n    // We want to focus on the first chooser option element as soon as the modal is opened.\n    modal.getRoot().on(ModalEvents.shown, () => {\n        modal.getModal()[0].tabIndex = -1;\n\n        modal.getBodyPromise()\n        .then(body => {\n            const firstChooserOption = body[0].querySelector(selectors.regions.chooserOption.container);\n            focusChooserOption(firstChooserOption);\n\n            return;\n        })\n        .catch(Notification.exception);\n    });\n\n    modal.show();\n};\n"],"file":"dialogue.min.js"}