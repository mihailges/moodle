YUI.add("moodle-atto_accessibilitychecker-button",function(h,t){var u="atto_accessibilitychecker";h.namespace("M.atto_accessibilitychecker").Button=h.Base.create("button",h.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"e/accessibility_checker",callback:this._displayDialogue})},_displayDialogue:function(){this.getDialogue({headerContent:M.util.get_string("pluginname",u),width:"500px",focusAfterHide:!0}).set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var t=h.Node.create('<div style="word-wrap: break-word;"></div>');return t.append(this._getWarnings()),t.delegate("click",function(t){t.preventDefault();var e=this.get("host"),i=t.currentTarget.getData("sourceNode"),n=this.getDialogue();i?(n.set("focusAfterHide",this.editor).hide(),e.setSelection(e.getSelectionFromNode(i))):n.hide()},"a",this),t},_getWarnings:function(){var s,t=h.Node.create("<div></div>");return s=[],this.editor.all("img").each(function(t){var e=t.getAttribute("alt");void 0!==e&&""!==e||"presentation"!==t.getAttribute("role")&&s.push(t)},this),this._addWarnings(t,M.util.get_string("imagesmissingalt",u),s,!0),s=[],this.editor.all("*").each(function(t){var e,i,n,r,a,o;if(""!==h.Lang.trim(t.get("text"))&&(e=t.getComputedStyle("color"),i=t.getComputedStyle("backgroundColor"),n=this._getLuminanceFromCssColor(e),((r=this._getLuminanceFromCssColor(i))<n?(n+.05)/(r+.05):(r+.05)/(n+.05))<=4.5)){for(o=!1,a=a=0;a<s.length;a++){if(-1!==t.ancestors("*").indexOf(s[a])){o=!0;break}if(-1!==s[a].ancestors("*").indexOf(t)){s[a]=t,o=!0;break}}o||s.push(t)}},this),this._addWarnings(t,M.util.get_string("needsmorecontrast",u),s,!1),1e3<this.editor.get("text").length&&!this.editor.one("h3, h4, h5")&&this._addWarnings(t,M.util.get_string("needsmoreheadings",u),[this.editor],!1),s=[],this.editor.all("table").each(function(t){var e=t.one("caption");null!==e&&""!==e.get("text").trim()||s.push(t)},this),this._addWarnings(t,M.util.get_string("tablesmissingcaption",u),s,!1),s=[],this.editor.all("table").each(function(t){null!==t.one("[colspan],[rowspan]")&&s.push(t)},this),this._addWarnings(t,M.util.get_string("tableswithmergedcells",u),s,!1),s=[],this.editor.all("table").each(function(i){if(i.one("tr").one("td"))i.all("tr").some(function(t){var e=t.one("th");return(!e||""===e.get("text").trim())&&(s.push(i),!0)},this);else{var e=!1;i.one("tr").all("th").some(function(t){return e=!0,""===t.get("text").trim()&&(s.push(i),!0)}),e||s.push(i)}},this),this._addWarnings(t,M.util.get_string("tablesmissingheaders",u),s,!1),t.hasChildNodes()||t.append("<p>"+M.util.get_string("nowarnings",u)+"</p>"),t},_addWarnings:function(t,e,i,n){var r,a,o,s,l,d,g,c;if(0<i.length){for(r=h.Node.create("<p>"+e+"</p>"),a=h.Node.create('<ol class="accessibilitywarnings"></ol>'),o=o=0;o<i.length;o++)d=h.Node.create("<li></li>"),(g=n?(s=i[o].getAttribute("src"),h.Node.create('<a href="#"><img src="'+s+'" /> '+s+"</a>")):(l="innerText"in i[o]?"innerText":"textContent",""===(c=i[o].get(l).trim())&&(c=M.util.get_string("emptytext",u)),i[o]===this.editor&&(c=M.util.get_string("entiredocument",u)),h.Node.create('<a href="#">'+c+"</a>"))).setData("sourceNode",i[o]),d.append(g),a.append(d);r.append(a),t.append(r)}},_getLuminanceFromCssColor:function(t){var e,i;return"transparent"===t&&(t="#ffffff"),.2126*(i=function(t){return(t=parseInt(t,10)/255)<=.03928?t/=12.92:t=Math.pow((t+.055)/1.055,2.4),t})((e=h.Color.toArray(h.Color.toRGB(t)))[0])+.7152*i(e[1])+.0722*i(e[2])}})},"@VERSION@",{requires:["color-base","moodle-editor_atto-plugin"]});