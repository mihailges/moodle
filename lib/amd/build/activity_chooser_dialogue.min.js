define ("core/activity_chooser_dialogue",["core/yui","jquery","core/pubsub","core/activity_chooser_events","core/local/aria/focuslock","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){var h=null,i=[],j=null,k=null,l={minheight:300,baseheight:400,maxheight:660,closeButtonTitle:{validator:a.Lang.isString,value:"Close"}},m=function(){var a;while(i.length){a=i.shift();b(a).off()}},n=function(){m();null.off();h.hide()},o=function(a){a.preventDefault();n()},p={MODULE_CHOOSER_CONTAINER:".modchoosercontainer",MODULES_AREA:".modulescontainer",MODULE_AREA:".module",MODULE_INFO_AREA:".modinfo",MODULE_INFO_ACTIONS:{ADD_MODULE:".modinfo .modicon a",SHOW_MODULE_SUMMARY:".modinfo .modactions .showmodsummary i"},MODULE_SUMMARY_AREA:".modsummary",MODULE_SUMMARY_ACTIONS:{ADD_MODULE:".modsummary .actions .addmodule",CLOSE_MODULE_SUMMARY:".modsummary .actions .closemodsummary"}},q=function(){var a=b(p.MODULE_INFO_ACTIONS.SHOW_MODULE_SUMMARY).on("click",function(a){var c=b(a.target).closest(p.MODULE_AREA).find(p.MODULE_SUMMARY_AREA);s(c)});i.push(a);a=b(p.MODULE_SUMMARY_ACTIONS.CLOSE_MODULE_SUMMARY).on("click",function(a){var c=b(a.target).closest(p.MODULE_AREA).find(p.MODULE_SUMMARY_AREA);c.removeClass("open");b(p.MODULE_CHOOSER_CONTAINER).removeClass("noscroll")});i.push(a);a=b(p.MODULE_AREA).on("keydown",function(a){var c=b(this).index(),d=b(p.MODULE_AREA).outerWidth(),e=b(p.MODULES_AREA).width(),f=Math.floor(e/d),g=b(p.MODULES_AREA).find(p.MODULE_AREA),h=g.length,i=Math.ceil(g.length/f),j=Math.ceil((c+1)/f);if(39===a.keyCode){var k=c+1;if("undefined"==typeof g[k]){return}u(g[c],g[k])}if(37===a.keyCode){var l=c-1;if("undefined"==typeof g[l]){return}u(g[c],g[l])}if(40===a.keyCode){if(j==i){return}var k=c+f;if("undefined"==typeof g[k]){k=h-1}u(g[c],g[k])}if(38===a.keyCode){if(1===j){return}var l=c-f;if("undefined"==typeof g[l]){l=0}u(g[c],g[l])}if(35===a.keyCode){var m=h-1;if(c===m){return}u(g[c],g[m])}if(36===a.keyCode){if(c===0){return}u(g[c],g[0])}if(13===a.keyCode||32==a.keyCode){var n=b(this).find(p.MODULE_INFO_ACTIONS.ADD_MODULE);b(n).attr("tabindex",0);b(n).focus();b(this).attr("tabindex",-1)}});i.push(a);a=b(".actionelement").on("keydown",function(a){a.preventDefault();a.stopPropagation();var c=b(this).closest("label").find(".actionelement"),d=b(c).index(this);if(40===a.keyCode||39===a.keyCode){var e=d+1;if("undefined"==typeof c[e]){return}var f=c[e];b(f).attr("tabindex",0);b(f).focus();b(this).attr("tabindex",-1)}if(38===a.keyCode||37===a.keyCode){var g=d-1;if("undefined"==typeof c[g]){return}var h=c[g];b(h).attr("tabindex",0);b(h).focus();b(this).attr("tabindex",-1)}if(27===a.keyCode){var i=b(this).closest(".option");b(i).attr("tabindex",0);b(i).focus();b(this).attr("tabindex",-1)}if(13===a.keyCode){if(b(this).hasClass("info")){var j=b(this).closest("label").find(".typesummary");s(j)}}});i.push(a)},r=function(a){var c=j.detach();return f.create({type:f.types.DEFAULT,body:c.html(),title:k.html(),large:!0}).then(function(c){c.getRoot().on(g.shown,function(){var c=b(p.MODULE_AREA).find(p.MODULE_INFO_ACTIONS.ADD_MODULE+", "+p.MODULE_SUMMARY_ACTIONS.ADD_MODULE);c.each(function(b,c){c.href+="&section="+a});var d=b(p.MODULES_AREA).find(p.MODULE_AREA),e=d[0];b(e).attr("tabindex",0);var f=b(p.MODULE_SUMMARY_AREA).find(".helplinkpopup");f.each(function(a,c){b(c).attr("tabindex",-1)});q()}.bind(this));c.getRoot().on(g.hidden,function(){c.getRoot().remove()}.bind(this));c.show();return c})},s=function(a){var c=b(p.MODULE_CHOOSER_CONTAINER).scrollTop(),d=b(p.MODULE_CHOOSER_CONTAINER).outerHeight();b(p.MODULE_CHOOSER_CONTAINER).addClass("noscroll");t(a,c,d);var e=a.find(".content");if(0<e.scrollTop()){e.scrollTop(0)}a.addClass("open");var f=a.find(p.MODULE_SUMMARY_ACTIONS.CLOSE_MODULE_SUMMARY),g=a.find(p.MODULE_SUMMARY_ACTIONS.ADD_MODULE);b(f).attr("tabindex",0);b(g).attr("tabindex",0)},t=function(a,b,c){console.log(c);var d=a.find(".content"),e=a.find(".actions"),f=c-e.outerHeight();d.css({height:f+"px"});a.css({top:b+"px",height:c+"px"})},u=function(a,c){b(c).attr("tabindex",0);b(c).focus();b(a).attr("tabindex",-1)};return{setupChooserDialogue:function setupChooserDialogue(a,b){j=a;k=b},displayChooser:function displayChooser(a,b){r(b)},updateHiddenRadioValue:function updateHiddenRadioValue(a,b){null.attr({value:b,name:a})}}});
//# sourceMappingURL=activity_chooser_dialogue.min.js.map
