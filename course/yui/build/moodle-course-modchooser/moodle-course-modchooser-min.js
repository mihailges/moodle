YUI.add("moodle-course-modchooser",function(e,t){var n={PAGECONTENT:"body",SECTION:null,SECTIONMODCHOOSER:"span.section-modchooser-link",SITEMENU:".block_site_main_menu",SITETOPIC:"div.sitetopic"},r="course-modchooser",i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,M.core.chooserdialogue,{sectionid:null,initializer:function(){var t=M.course.format.get_sectionwrapperclass();t&&(n.SECTION="."+t);var r=e.one(".chooserdialoguebody"),i=e.one(".choosertitle"),s={width:"800"};this.setup_chooser_dialogue(r,i,s),this.setup_for_section(),M.course.coursebase.register_module(this)},setup_for_section:function(t){t||(t=n.PAGECONTENT),e.one(t).all(n.SITETOPIC).each(function(e){this._setup_for_section(e)},this),n.SECTION&&e.one(t).all(n.SECTION).each(function(e){this._setup_for_section(e)},this),e.one(t).all(n.SITEMENU).each(function(e){this._setup_for_section(e)},this)},_setup_for_section:function(t){var r=t.one(n.SECTIONMODCHOOSER);if(!r)return;var i=e.Node.create("<a href='#' />");r.get("children").each(function(e){i.appendChild(e)}),r.insertBefore(i),i.on("click",this.display_mod_chooser,this)},display_mod_chooser:function(t){if(t.target.ancestor(n.SITETOPIC))this.sectionid=1;else if(t.target.ancestor(n.SECTION)){var r=t.target.ancestor(n.SECTION);this.sectionid=r.get("id").replace("section-","")}else t.target.ancestor(n.SITEMENU)&&(this.sectionid=0);this.prepare_chooser(),t.preventDefault();var i=this.panel.get("boundingBox"),s=this.container.one(".alloptions"),o=e.one("document").on("orientationchange",function(){this.center_dialogue(s)},this);this.listenevents.push(o),o=e.one("window").on("resize",function(){this.center_dialogue(s)},this),this.listenevents.push(o),o=this.container.on("click",this.check_options,this),this.listenevents.push(o),o=this.container.on("key_up",this.check_options,this),this.listenevents.push(o),o=this.container.on("dblclick",function(e){e.target.ancestor("div.option")&&(this.check_options(),this.submitbutton.setAttribute("disabled","disabled"),this.options.setAttribute("disabled","disabled"),this.cancel_listenevents(),this.container.one("form").submit())},this),this.listenevents.push(o),this.container.one("form").on("submit",function(){this.submitbutton.setAttribute("disabled","disabled"),this.options.setAttribute("disabled","disabled"),this.cancel_listenevents()},this),o=this.container.one(".addcancel").on("click",this.cancel_popup,this),this.listenevents.push(o),o=i.one("button.closebutton").on("click",this.cancel_popup,this),this.listenevents.push(o),o=e.one("document").on("keydown",this.handle_key_press,this),this.listenevents.push(o),this.submitbutton=this.container.one(".submitbutton"),this.submitbutton.set("disabled","true"),this.options.removeAttribute("disabled"),this.panel.show(t),this.center_dialogue(s),this.container.one(".option input[type=radio]").focus(),this.check_options()},option_selected:function(e){this.hiddenRadioValue.setAttrs({name:"jump",value:e.get("value")+"&section="+this.sectionid})}},{NAME:r,ATTRS:{maxheight:{value:800}}}),M.course=M.course||{},M.course.init_chooser=function(e){return new i(e)}},"@VERSION@",{requires:["moodle-core-chooserdialogue","moodle-course-coursebase"]});
