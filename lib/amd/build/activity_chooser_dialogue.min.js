define ("core/activity_chooser_dialogue",["core/yui","jquery","core/pubsub","core/activity_chooser_events","core/local/aria/focuslock"],function(a,b,c,d,e){var f=null,g=null,h=null,i=[],j=null,k=null,l=null,m={minheight:300,baseheight:400,maxheight:660,closeButtonTitle:{validator:a.Lang.isString,value:"Close"}},n=function(){var a;while(i.length){a=i.shift();b(a).off()}},o=function(){n();g.off();f.hide()},p=function(a){a.preventDefault();o()},q=function(a){var b=[];b.push("modchooserdialogue-course-modchooser".toLowerCase());if(a){for(var c in a){b.push(("modchooserdialogue-course-modchooser-"+c).toLowerCase())}}return b},r=function(){if(f){return}b("body").addClass("jschooser");var a,c={bodyContent:j.html(),headerContent:k.html(),width:"540px",draggable:!0,visible:!1,zindex:100,modal:!0,shim:!0,closeButtonTitle:m.closeButtonTitle,focusOnPreviousTargetAfterHide:!0,render:!1,extraClasses:q()};for(a in l){c[a]=l[a]}f=new M.core.dialogue(c);j.remove();k.remove();f.hide();f.render();g=b(f.get("boundingBox").one(".modchoosercontainer").getDOMNode());h=g.find(".option");var d=h[0];b(d).attr("tabindex",0);var e=g.find(".helplinkpopup");e.each(function(a,c){b(c).attr("tabindex",-1)});f.get("boundingBox").addClass("modchooserdialogue")},s=function(a){var c=f.get("boundingBox"),d=c.get("winHeight"),e,g;if(f.shouldResizeFullscreen()){return}e=m.maxheight;if(d<=e){if(d<=m.minheight){e=m.minheight}else{e=d}}if(e>m.minheight){if(f.lockScroll&&!f.lockScroll.isActive()){f.lockScroll.enableScrollLock(!0)}}else{if(f.lockScroll&&f.lockScroll.isActive()){f.lockScroll.disableScrollLock()}}g=e;e=e-110;b(a).css("maxHeight",e+"px");var h=c.getStyle("height");if(h.match(/.*px$/)){h=h.replace(/px$/,"")}else{h=g}if(h<m.baseheight){h=m.baseheight;b(a).css("height",h+"px")}f.centerDialogue()},t=function(a,b){null.attr({value:b,name:a})},u=function(a){t(a.name,a.value);c.publish(d.OPTION_SELECTED,a)},v=function(a){var c=b(".alloptions").scrollTop(),d=b(".alloptions").outerHeight();b(".alloptions").addClass("noscroll");w(a,c,d);var f=a.find(".content");if(0<f.scrollTop()){f.scrollTop(0)}a.addClass("open");var g=a.find(".closetypesummary"),h=a.find(".addbutton");b(g).attr("tabindex",0);b(h).attr("tabindex",0);e.trapFocus(a)},w=function(a,b,c){var d=a.find(".content"),e=a.find(".action-footer"),f=e.height();d.css({height:c-f+"px"});a.css({top:b+"px",height:c+"px"})},x=function(a,c){b(c).attr("tabindex",0);b(c).focus();b(a).attr("tabindex",-1)},y=function(a,c){var d,e,j;r();a.preventDefault();d=f.get("boundingBox");e=g.find(".alloptions");var k=e.find(".option .modicon a, .option .typesummary .action-footer .addbutton");k.each(function(a,b){b.href+="&section="+c});j=b(".info.actionelement").on("click",function(a){var c=b(a.target).closest("label").find(".typesummary");v(c)});i.push(j);j=b(".closetypesummary").on("click",function(a){setTimeout(function(){var c=b(a.target).closest("label").find(".typesummary");c.removeClass("open");b(".alloptions").removeClass("noscroll")},100)});i.push(j);j=b(document).on("orientationchange",function(){s(e)});i.push(j);j=b(window).on("resize",function(){s(e)});i.push(j);j=b(".option").on("keydown",function(a){var c=b(this).index(),d=b(".option").outerWidth(),e=b(".alloptions").width(),f=Math.floor(e/d),g=h.length,i=Math.floor(h.length/f),j=Math.ceil((c+1)/f);if(39===a.keyCode){var k=c+1;if("undefined"==typeof h[k]){return}x(h[c],h[k])}if(37===a.keyCode){var l=c-1;if("undefined"==typeof h[l]){return}x(h[c],h[l])}if(40===a.keyCode){if(j==i){return}var k=c+f;if("undefined"==typeof h[k]){k=g-1}x(h[c],h[k])}if(38===a.keyCode){if(1===j){return}var l=c-f;if("undefined"==typeof h[l]){l=0}x(h[c],h[l])}if(35===a.keyCode){var m=g-1;if(c===m){return}x(h[c],h[m])}if(36===a.keyCode){if(c===0){return}x(h[c],h[0])}if(13===a.keyCode||32==a.keyCode){var n=b(this).find(".actionelement");b(n[0]).attr("tabindex",0);b(n[0]).focus();b(this).attr("tabindex",-1)}});i.push(j);j=b(".actionelement").on("keydown",function(a){a.preventDefault();a.stopPropagation();var c=b(this).closest("label").find(".actionelement"),d=b(c).index(this);if(40===a.keyCode||39===a.keyCode){var e=d+1;if("undefined"==typeof c[e]){return}var f=c[e];b(f).attr("tabindex",0);b(f).focus();b(this).attr("tabindex",-1)}if(38===a.keyCode||37===a.keyCode){var g=d-1;if("undefined"==typeof c[g]){return}var h=c[g];b(h).attr("tabindex",0);b(h).focus();b(this).attr("tabindex",-1)}if(27===a.keyCode){var i=b(this).closest(".option");b(i).attr("tabindex",0);b(i).focus();b(this).attr("tabindex",-1)}if(13===a.keyCode){if(b(this).hasClass("info")){var j=b(this).closest("label").find(".typesummary");v(j)}}});i.push(j);j=d.one("button.closebutton").on("click",function(a){p(a)});i.push(j);f.show(a);s(e);g.find(".option input[type=radio]").focus()};return{setupChooserDialogue:function setupChooserDialogue(a,b,c){j=a;k=b;l=c},displayChooser:y,updateHiddenRadioValue:t}});
//# sourceMappingURL=activity_chooser_dialogue.min.js.map
