define(["core/yui","jquery"],function(a,b){var c=null,d=null,e=null,f=null,g=[],h=null,i=null,j=null,k=null,l={minheight:300,baseheight:400,maxheight:660,closeButtonTitle:{validator:a.Lang.isString,value:"Close"}},m=function(a,b,c){h=a,i=b,j=c},n=function(){for(var a;g.length;)a=g.shift(),a.detach()},o=function(){n(),e.detachAll(),c.hide()},p=function(a){a.preventDefault(),o()},q=function(a){var b="chooserdialogue-"+name,c=[];if(c.push(b.toLowerCase()),a){var d;for(d in a)c.push((b+"-"+d).toLowerCase())}return c},r=function(){if(!c){b("body").addClass("jschooser");var a,d={bodyContent:h.innerHTML,headerContent:i.innerHTML,width:"540px",draggable:!0,visible:!1,zindex:100,modal:!0,shim:!0,closeButtonTitle:l.closeButtonTitle,focusOnPreviousTargetAfterHide:!0,render:!1,extraClasses:q()};for(a in j)d[a]=j[a];c=new M.core.dialogue(d),h.remove(),i.remove(),c.hide(),c.render(),e=b(".choosercontainer"),f=e.children(".option input[type=radio]"),k='<input type="hidden" value="" />',e.find("form").appendChild(k),c.get("boundingBox").addClass("chooserdialogue")}},s=function(a){var b,d,e=c.get("boundingBox"),f=e.get("winHeight");if(!c.shouldResizeFullscreen()){b=l.maxheight,f<=b&&(b=f<=l.minheight?l.minheight:f),b>l.minheight?c.lockScroll&&!c.lockScroll.isActive()&&c.lockScroll.enableScrollLock(!0):c.lockScroll&&c.lockScroll.isActive()&&c.lockScroll.disableScrollLock(),d=b,b-=110,a.setStyle("maxHeight",b+"px");var g=e.getStyle("height");g=g.match(/.*px$/)?g.replace(/px$/,""):d,g<l.baseheight&&(g=l.baseheight,a.setStyle("height",g+"px")),c.centerDialogue()}},t=function(a){27===a.keyCode&&p(a)},u=function(a){k.setAttrs({value:a.get("value"),name:a.get("name")})},v=function(){f.each(function(a){var b=a.get("parentNode").get("parentNode");a.get("checked")?(b.addClass("selected"),u(a),d.removeAttribute("disabled"),a.focus()):b.removeClass("selected")},this)},w=function(a){var h,i,j;r(),a.preventDefault(),h=c.get("boundingBox"),i=e.find(".alloptions"),j=b(document).on("orientationchange",function(){s(i)},this),g.push(j),j=b(window).on("resize",function(){s(i)},this),g.push(j),j=e.on("click",v,this),g.push(j),j=e.on("key_up",this.checkOptions,this),g.push(j),j=e.on("dblclick",function(a){a.target.ancestor("div.option")&&(v(),d.setAttribute("disabled","disabled"),f.setAttribute("disabled","disabled"),n(),e.find("form").submit())},this),g.push(j),e.find("form").on("submit",function(){d.setAttribute("disabled","disabled"),f.setAttribute("disabled","disabled"),n()},this),j=e.find(".addcancel").on("click",p,this),g.push(j),j=h.find("button.closebutton").on("click",p,this),g.push(j),j=b(document).on("keydown",t,this),g.push(j),d=e.find(".submitbutton"),d.attr("disabled","true"),f.removeAttribute("disabled"),c.show(a),s(i),e.find(".option input[type=radio]").focus(),v()};return{setupChooserDialogue:m(),displayChooser:w()}});