YUI.add("moodle-atto_managefiles-usedfiles",function(f,e){var o="has-missing-files",r="has-unused-files",u=".fitem",m="#atto_managefiles_manageform",g=".missing-files";M.atto_managefiles=M.atto_managefiles||{},M.atto_managefiles.usedfiles=M.atto_managefiles.usedfiles||{_usercontext:null,_itemid:null,_elementid:null,init:function(e){var i,t,n,s,l,a,d;if(this._usercontext=e.usercontext,this._itemid=e.itemid,this._elementid=e.elementid,i=e.files,(t=f.one(m))&&window.parent)if(n=this._getUsedFiles(),s=this.findUnusedFiles(i,n),l=this.findMissingFiles(i,n),0<s.length?(t.all('input[type=checkbox][name^="deletefile"]').each(function(e){-1===f.Array.indexOf(s,e.getData("filename"))&&e.ancestor(u).remove()}),t.addClass(r)):t.removeClass(r),0<l.length){for(a="<ul>",d=0;d<l.length;d++)a+="<li>"+f.Escape.html(l[d])+"</li>";a+="</ul>",t.one(g).setHTML("").append(a),t.addClass(o)}else t.removeClass(o)},_getUsedFiles:function(){for(var e=f.one(window.parent.document.getElementById(this._elementid+"editable")),i=M.cfg.wwwroot+"/draftfile.php/"+this._usercontext+"/user/draft/"+this._itemid+"/",t=new RegExp(i.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")+"(.+?)[\\?\"']","gm"),n="",s={};null!==(n=t.exec(e.get("innerHTML")));)s[decodeURI(n[1])]=!0;return s},findUnusedFiles:function(e,i){var t,n=[];for(t in e)i[t]||n.push(t);return n},findMissingFiles:function(e,i){var t,n=[];for(t in i)e[t]||n.push(t);return n}}},"@VERSION@",{requires:["node","escape"]});