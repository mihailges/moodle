{"version":3,"sources":["../src/modchooser.js"],"names":["define","Y","$","chooserDialogue","PubSub","ActivityChooserEvents","CSS","PAGECONTENT","SECTION","SECTIONMODCHOOSER","SITEMENU","SITETOPIC","modChooserData","sectionid","displayModChooser","e","currentTarget","parents","length","section","attr","replace","content","detach","title","console","log","setupChooserDialogue","data","displayChooser","_setupForSection","chooserspan","find","modchooserlink","children","wrapAll","on","preventDefault","setupForSection","baseselector","each","optionSelected","thisoption","updateHiddenRadioValue","value","init","initializer","use","sectionclass","M","course","format","get_sectionwrapperclass","subscribe","OPTION_SELECTED","setModChooserData"],"mappings":"AA2BAA,OAAM,0BACF,CACI,UADJ,CAEI,QAFJ,CAGI,gCAHJ,CAII,8BAJJ,CADE,CAOF,SACIC,CADJ,CAEIC,CAFJ,CAGIC,CAHJ,CAIIC,CAJJ,CAKIC,CALJ,CAME,IAEEC,CAAAA,CAAG,CAAG,CACNC,WAAW,CAAE,MADP,CAENC,OAAO,CAAE,IAFH,CAGNC,iBAAiB,CAAE,8BAHb,CAINC,QAAQ,CAAE,uBAJJ,CAKNC,SAAS,CAAE,eALL,CAFR,CAUEC,CAAc,CAAG,IAVnB,CAoBEC,CAAS,CAAG,IApBd,CAgCEC,CAAiB,CAAG,SAASC,CAAT,CAAY,CAEhC,GAAIb,CAAC,CAACa,CAAC,CAACC,aAAH,CAAD,CAAmBC,OAAnB,CAA2BX,CAAG,CAACK,SAA/B,EAA0CO,MAA9C,CAAsD,CAElDL,CAAS,CAAG,CACf,CAHD,IAGO,IAAIX,CAAC,CAACa,CAAC,CAACC,aAAH,CAAD,CAAmBC,OAAnB,CAA2BX,CAAG,CAACE,OAA/B,EAAwCU,MAA5C,CAAoD,CACvD,GAAIC,CAAAA,CAAO,CAAGjB,CAAC,CAACa,CAAC,CAACC,aAAH,CAAD,CAAmBC,OAAnB,CAA2BX,CAAG,CAACE,OAA/B,CAAd,CACAK,CAAS,CAAGM,CAAO,CAACC,IAAR,CAAa,IAAb,EAAmBC,OAAnB,CAA2B,UAA3B,CAAuC,EAAvC,CACf,CAHM,IAGA,IAAInB,CAAC,CAACa,CAAC,CAACC,aAAH,CAAD,CAAmBC,OAAnB,CAA2BX,CAAG,CAACI,QAA/B,EAAyCQ,MAA7C,CAAqD,CAExDL,CAAS,CAAG,CACf,CAX+B,GAc5BS,CAAAA,CAAO,CAAGpB,CAAC,CAAC,yBAAD,CAAD,CAA6BqB,MAA7B,EAdkB,CAe5BC,CAAK,CAAGtB,CAAC,CAAC,kBAAD,CAfmB,CAmBhCuB,OAAO,CAACC,GAAR,CAAYd,CAAZ,EACAT,CAAe,CAACwB,oBAAhB,CAAqCH,CAArC,CAA4CI,IAA5C,EACAzB,CAAe,CAAC0B,cAAhB,CAA+Bd,CAA/B,CACH,CAtDC,CAgEEe,CAAgB,CAAG,SAASX,CAAT,CAAkB,CACrC,GAAIY,CAAAA,CAAW,CAAG7B,CAAC,CAACiB,CAAD,CAAD,CAAWa,IAAX,CAAgB1B,CAAG,CAACG,iBAApB,CAAlB,CACA,GAAI,CAACsB,CAAW,CAACb,MAAjB,CAAyB,CACrB,MACH,CACD,GAAIe,CAAAA,CAAc,CAAG/B,CAAC,CAAC6B,CAAD,CAAD,CAAeG,QAAf,GAA0BC,OAA1B,CAAkC,qCAAlC,CAArB,CAEAjC,CAAC,CAAC+B,CAAD,CAAD,CAAkBG,EAAlB,CAAqB,OAArB,CAA8B,SAASrB,CAAT,CAAY,CACtCU,OAAO,CAACC,GAAR,CAAYd,CAAZ,EACAG,CAAC,CAACsB,cAAF,GACAvB,CAAiB,CAACC,CAAD,CACpB,CAJD,CAKH,CA5EC,CAqFEuB,CAAe,CAAG,SAASC,CAAT,CAAuB,CACzC,GAAI,CAACA,CAAL,CAAmB,CACfA,CAAY,CAAGjC,CAAG,CAACC,WACtB,CAEDL,CAAC,CAACqC,CAAD,CAAD,CAAgBP,IAAhB,CAAqB1B,CAAG,CAACK,SAAzB,EAAoC6B,IAApC,CAAyC,UAAW,CAChDV,CAAgB,CAAC,IAAD,CACnB,CAFD,EAIA,GAAIxB,CAAG,CAACE,OAAR,CAAiB,CACbN,CAAC,CAACqC,CAAD,CAAD,CAAgBP,IAAhB,CAAqB1B,CAAG,CAACE,OAAzB,EAAkCgC,IAAlC,CAAuC,UAAW,CAC9CV,CAAgB,CAAC,IAAD,CACnB,CAFD,CAGH,CAGD5B,CAAC,CAACqC,CAAD,CAAD,CAAgBP,IAAhB,CAAqB1B,CAAG,CAACI,QAAzB,EAAmC8B,IAAnC,CAAwC,UAAW,CAC/CV,CAAgB,CAAC,IAAD,CACnB,CAFD,CAGH,CAxGC,CAkHEW,CAAc,CAAG,SAASC,CAAT,CAAqB,CAEtCvC,CAAe,CAACwC,sBAAhB,CAAuC,MAAvC,CAA+CD,CAAU,CAACE,KAAX,CAAmB,WAAnB,CAAiC/B,CAAhF,CACH,CArHC,CAyIF,MAA6C,CACzCgC,IAAI,CAdU,QAAdC,CAAAA,WAAc,EAAW,CACzB7C,CAAC,CAAC8C,GAAF,CAAM,0BAAN,CAAkC,UAAW,CACzC,GAAIC,CAAAA,CAAY,CAAGC,CAAC,CAACC,MAAF,CAASC,MAAT,CAAgBC,uBAAhB,EAAnB,CACA,GAAIJ,CAAJ,CAAkB,CACd1C,CAAG,CAACE,OAAJ,CAAc,IAAMwC,CACvB,CAEDV,CAAe,EAClB,CAPD,EASAlC,CAAM,CAACiD,SAAP,CAAiBhD,CAAqB,CAACiD,eAAvC,CAAwDb,CAAxD,CACH,CAE4C,CAEzCc,iBAAiB,CArHG,QAApBA,CAAAA,iBAAoB,CAAS3B,CAAT,CAAe,CACnChB,CAAc,CAAGgB,CACpB,CAiH4C,CAIhD,CA1JK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A system for displaying notifications to users from the session.\n *\n * Wrapper for the YUI M.core.notification class. Allows us to\n * use the YUI version in AMD code until it is replaced.\n *\n * @module     core_course/modchooser\n * @package    core_course\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      2.9\n */\ndefine(\n    [\n        'core/yui',\n        'jquery',\n        'core/activity_chooser_dialogue',\n        'core/activity_chooser_events',\n    ],\n    function(\n        Y,\n        $,\n        chooserDialogue,\n        PubSub,\n        ActivityChooserEvents\n    ) {\n\n    var CSS = {\n        PAGECONTENT: 'body',\n        SECTION: null,\n        SECTIONMODCHOOSER: 'span.section-modchooser-link',\n        SITEMENU: '.block_site_main_menu',\n        SITETOPIC: 'div.sitetopic'\n    };\n\n    var modChooserData = null;\n\n    /**\n     * The current section ID.\n     *\n     * @property sectionid\n     * @private\n     * @type Number\n     * @default null\n     */\n    var sectionid = null;\n\n    var setModChooserData = function(data) {\n        modChooserData = data;\n    };\n\n    /**\n     * Display the module chooser\n     *\n     * @method display_mod_chooser\n     * @param {EventFacade} e Triggering Event\n     */\n    var displayModChooser = function(e) {\n        // Set the section for this version of the dialogue\n        if ($(e.currentTarget).parents(CSS.SITETOPIC).length) {\n            // The site topic has a sectionid of 1\n            sectionid = 1;\n        } else if ($(e.currentTarget).parents(CSS.SECTION).length) {\n            var section = $(e.currentTarget).parents(CSS.SECTION);\n            sectionid = section.attr('id').replace('section-', '');\n        } else if ($(e.currentTarget).parents(CSS.SITEMENU).length) {\n            // The block site menu has a sectionid of 0\n            sectionid = 0;\n        }\n\n        //var dialogue = $('.modchooserdialoguebody');\n        var content = $('.modchooserdialoguebody').detach();\n        var title = $('.modchoosertitle');\n        var urlParams = {\n            section:  sectionid\n        };\n        console.log(modChooserData);\n        chooserDialogue.setupChooserDialogue(title, data);\n        chooserDialogue.displayChooser(e);\n    };\n\n    /**\n     * Update any section areas within the scope of the specified\n     * selector with AJAX equivalents\n     *\n     * @method _setup_for_section\n     * @private\n     * @param baseselector The selector to limit scope to\n     */\n    var _setupForSection = function(section) {\n        var chooserspan = $(section).find(CSS.SECTIONMODCHOOSER);\n        if (!chooserspan.length) {\n            return;\n        }\n        var modchooserlink = $(chooserspan).children().wrapAll(\"<a href='#' class='chooser-link' />\");\n\n        $(modchooserlink).on('click', function(e) {\n            console.log(modChooserData);\n            e.preventDefault();\n            displayModChooser(e);\n        });\n    };\n\n     /**\n     * Update any section areas within the scope of the specified\n     * selector with AJAX equivalents\n     *\n     * @method setup_for_section\n     * @param baseselector The selector to limit scope to\n     */\n    var setupForSection = function(baseselector) {\n        if (!baseselector) {\n            baseselector = CSS.PAGECONTENT;\n        }\n        // Setup for site topics\n        $(baseselector).find(CSS.SITETOPIC).each(function() {\n            _setupForSection(this);\n        });\n        // Setup for standard course topics\n        if (CSS.SECTION) {\n            $(baseselector).find(CSS.SECTION).each(function() {\n                _setupForSection(this);\n            });\n        }\n\n        // Setup for the block site menu\n        $(baseselector).find(CSS.SITEMENU).each(function() {\n            _setupForSection(this);\n        });\n    };\n\n    /**\n     * Helper function to set the value of a hidden radio button when a\n     * selection is made.\n     *\n     * @method option_selected\n     * @param {String} thisoption The selected option value\n     * @private\n     */\n    var optionSelected = function(thisoption) {\n        // Add the sectionid to the URL.\n        chooserDialogue.updateHiddenRadioValue('jump', thisoption.value + '&section=' + sectionid);\n    };\n\n    /**\n     * Set up the activity chooser.\n     *\n     * @method initializer\n     */\n    var initializer = function() {\n        Y.use('moodle-course-coursebase', function() {\n            var sectionclass = M.course.format.get_sectionwrapperclass();\n            if (sectionclass) {\n                CSS.SECTION = '.' + sectionclass;\n            }\n            // Initialize existing sections and register for dynamically created sections\n            setupForSection();\n        });\n\n        PubSub.subscribe(ActivityChooserEvents.OPTION_SELECTED, optionSelected);\n    };\n\n    return /** @alias module:core/notification */{\n        init: initializer,\n        setModChooserData: setModChooserData\n    };\n});\n"],"file":"modchooser.min.js"}