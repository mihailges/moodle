{"version":3,"sources":["../src/activity_chooser_dialogue.js"],"names":["define","$","ActivityChooserEvents","FocusLock","ModalFactory","ModalEvents","panel","listenevents","bodycontent","headercontent","ATTRS","minheight","baseheight","maxheight","closeButtonTitle","validator","Y","Lang","isString","value","cancelListenevents","thisevent","length","shift","off","hide","SELECTORS","CHOOSER_CONTAINER","CHOOSER_OPTIONS_CONTAINER","CHOOSER_OPTION_CONTAINER","CHOOSER_OPTION_ACTIONS_CONTAINER","CHOOSER_OPTION_INFO_CONTAINER","CHOOSER_OPTION_SUMMARY_CONTAINER","CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER","CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER","CHOOSER_OPTION_ACTION_GROUP_ELEMENT","CHOOSER_OPTION_ACTIONS","SHOW_CHOOSER_OPTION_SUMMARY","ADD_CHOOSER_OPTION","CLOSE_CHOOSER_OPTION_SUMMARY","registerListenerEvents","on","e","optionSummaryElement","target","closest","find","showOptionSummary","push","removeClass","index","chooserOptionOuterWidth","outerWidth","chooserOptionsContainerWidth","width","chooserOptionsPerRow","Math","floor","chooserOptions","totalChooserOptions","totalRowsCount","ceil","indexRow","keyCode","nextIndex","moveFocus","prevIndex","lastChooserOptionIndex","Object","values","forEach","chooserOptionActionElement","attr","addChooserOptionActionElement","focus","preventDefault","stopPropagation","chooserOptionActions","console","log","chooserOption","parent","hasClass","chooserOptionSummary","MODULE_AREA","MODULE_SUMMARY_AREA","prepareChooser","sectionid","body","detach","create","type","types","DEFAULT","html","title","large","then","modal","getRoot","shown","anchors","each","anchor","href","firstChooserOption","moreInfoLinks","key","moreInfoLink","bind","hidden","remove","show","topPosition","scrollTop","height","outerHeight","addClass","setOptionSummaryPositionAndHeight","optionSummaryContentElement","cancelAction","addAction","ADD_MODULE","position","optionSumarryActionsElement","contentHeight","css","fromElement","toElement","setupChooserDialogue","displayChooser"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A system for displaying notifications to users from the session.\n *\n * Wrapper for the YUI M.core.notification class. Allows us to\n * use the YUI version in AMD code until it is replaced.\n *\n * @module     core/activity_chooser_dialogue\n * @package    core\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.7\n */\ndefine(\n    [\n        'jquery',\n        'core/activity_chooser_events',\n        'core/local/aria/focuslock',\n        'core/modal_factory',\n        'core/modal_events'\n    ],\n    function(\n        $,\n        ActivityChooserEvents,\n        FocusLock,\n        ModalFactory,\n        ModalEvents\n    ) {\n\n     // The panel widget\n    var panel = null;\n\n    // The submit button - we disable this until an element is set\n    var submitbutton = null;\n\n    // The chooserdialogue container\n    var container = null;\n\n    var options = null;\n\n    // Any event listeners we may need to cancel later\n    var listenevents = [];\n\n    var bodycontent = null;\n    var headercontent = null;\n    var instanceconfig = null;\n\n    // The hidden field storing the disabled element values for submission.\n    var hiddenRadioValue = null;\n\n    var ATTRS = {\n        /**\n         * The minimum height (in pixels) before resizing is prevented and scroll\n         * locking disabled.\n         *\n         * @attribute minheight\n         * @type Number\n         * @default 300\n         */\n        minheight: 300,\n\n        /**\n         * The base height??\n         *\n         * @attribute baseheight\n         * @type Number\n         * @default 400\n         */\n        baseheight: 400,\n\n        /**\n         * The maximum height (in pixels) at which we stop resizing.\n         *\n         * @attribute maxheight\n         * @type Number\n         * @default 300\n         */\n        maxheight: 660,\n\n        /**\n         * The title of the close button.\n         *\n         * @attribute closeButtonTitle\n         * @type String\n         * @default 'Close'\n         */\n        closeButtonTitle: {\n            validator: Y.Lang.isString,\n            value: 'Close'\n        }\n    };\n\n    var setupChooserDialogue = function(body, title) {\n        bodycontent = body;\n        headercontent = title;\n    };\n\n    /**\n     * Cancel any listen events in the listenevents queue\n     *\n     * Several locations add event handlers which should only be called before the form is submitted. This provides\n     * a way of cancelling those events.\n     *\n     * @method cancel_listenevents\n     */\n    var cancelListenevents = function() {\n        // Detach all listen events to prevent duplicate triggers\n        var thisevent;\n        while (listenevents.length) {\n            thisevent = listenevents.shift();\n            $(thisevent).off();\n        }\n    };\n\n    var hide = function() {\n        // Cancel all listen events\n        cancelListenevents();\n        container.off();\n        panel.hide();\n    };\n\n    var cancelPopup = function(e) {\n        // Prevent normal form submission before hiding\n        e.preventDefault();\n        hide();\n    };\n\n    //   /**\n    //  * Return an array of class names prefixed with 'modchooserdialogue-' and\n    //  * the name of the type of dialogue.\n    //  *\n    //  * Note: Class name are converted to lower-case.\n    //  *\n    //  * If an array of arguments is supplied, each of these is prefixed and\n    //  * lower-cased also.\n    //  *\n    //  * If no arguments are supplied, then the prefix is returned on it's\n    //  * own.\n    //  *\n    //  * @method _getClassNames\n    //  * @param {Array} [args] Any additional names to prefix and lower-case.\n    //  * @return {Array}\n    //  * @private\n    //  */\n    // var _getClassNames = function(args) {\n    //     var prefix = 'modchooserdialogue-course-modchooser',\n    //         results = [];\n    //\n    //     results.push(prefix.toLowerCase());\n    //     if (args) {\n    //         var arg;\n    //         for (arg in args) {\n    //             results.push((prefix + '-' + arg).toLowerCase());\n    //         }\n    //     }\n    //\n    //     return results;\n    // };\n\n    var SELECTORS = {\n        CHOOSER_CONTAINER: '[data-region=\"chooser-container\"]',\n        CHOOSER_OPTIONS_CONTAINER: '[data-region=\"chooser-options-container\"]',\n        CHOOSER_OPTION_CONTAINER: '[data-region=\"chooser-option-container\"]',\n        CHOOSER_OPTION_ACTIONS_CONTAINER: '[data-region=\"chooser-option-actions-container\"]',\n        CHOOSER_OPTION_INFO_CONTAINER: '[data-region=\"chooser-option-info-container\"]',\n        CHOOSER_OPTION_SUMMARY_CONTAINER: '[data-region=\"chooser-option-summary-container\"]',\n        CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER: '[data-region=\"chooser-option-summary-content-container\"]',\n        CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER: '[data-region=\"chooser-option-summary-actions-container\"]',\n        CHOOSER_OPTION_ACTION_GROUP_ELEMENT: '[data-group=\"chooser-option-action\"]',\n        CHOOSER_OPTION_ACTIONS: {\n            SHOW_CHOOSER_OPTION_SUMMARY: '[data-action=\"show-option-summary\"]',\n        },\n        ADD_CHOOSER_OPTION: '[data-action=\"add-chooser-option\"]',\n        CLOSE_CHOOSER_OPTION_SUMMARY: '[data-action=\"close-chooser-option-summary\"]',\n    };\n\n    var registerListenerEvents = function() {\n        // Show the chooser option summary.\n        var thisevent = $(SELECTORS.CHOOSER_OPTION_ACTIONS.SHOW_CHOOSER_OPTION_SUMMARY).on('click', function(e) {\n            var optionSummaryElement = $(e.target).closest(SELECTORS.CHOOSER_OPTION_CONTAINER)\n                .find(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTAINER);\n            showOptionSummary(optionSummaryElement);\n        });\n        listenevents.push(thisevent);\n\n        // Close the chooser option summary.\n        thisevent = $(SELECTORS.CLOSE_CHOOSER_OPTION_SUMMARY).on('click', function(e) {\n            var optionSummaryElement = $(e.target).closest(SELECTORS.CHOOSER_OPTION_CONTAINER)\n                .find(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTAINER);\n            optionSummaryElement.removeClass('open');\n            $(SELECTORS.CHOOSER_CONTAINER).removeClass('noscroll');\n        });\n        listenevents.push(thisevent);\n\n        thisevent = $(SELECTORS.CHOOSER_OPTION_CONTAINER).on('keydown', function(e) {\n            var index = $(this).index();\n\n            var chooserOptionOuterWidth = $(SELECTORS.CHOOSER_OPTION_CONTAINER).outerWidth();\n            var chooserOptionsContainerWidth = $(SELECTORS.CHOOSER_OPTIONS_CONTAINER).width();\n            var chooserOptionsPerRow = Math.floor(chooserOptionsContainerWidth / chooserOptionOuterWidth);\n            var chooserOptions = $(SELECTORS.CHOOSER_OPTIONS_CONTAINER).find(SELECTORS.CHOOSER_OPTION_CONTAINER);\n            var totalChooserOptions = chooserOptions.length;\n            var totalRowsCount = Math.ceil(totalChooserOptions / chooserOptionsPerRow);\n            var indexRow = Math.ceil((index + 1) / chooserOptionsPerRow);\n\n            // Right key.\n            if (e.keyCode === 39) {\n                var nextIndex = index + 1;\n                if (typeof chooserOptions[nextIndex] === 'undefined') {\n                    return;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[nextIndex]);\n            }\n\n            // Left key.\n            if (e.keyCode === 37) {\n                var prevIndex = index - 1;\n                if (typeof chooserOptions[prevIndex] === 'undefined') {\n                    return;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[prevIndex]);\n            }\n\n            // Down key.\n            if (e.keyCode === 40) {\n                // If the focus is on an element from the last visual row.\n                if (indexRow == totalRowsCount) {\n                    return;\n                }\n                var nextIndex = index + chooserOptionsPerRow;\n                if (typeof chooserOptions[nextIndex] === 'undefined') {\n                    nextIndex = totalChooserOptions - 1;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[nextIndex]);\n            }\n\n            // Up key.\n            if (e.keyCode === 38) {\n                // if the focus is on an element from the first visual row.\n                if (indexRow === 1) {\n                    return;\n                }\n                var prevIndex = index - chooserOptionsPerRow;\n                if (typeof chooserOptions[prevIndex] === 'undefined') {\n                    prevIndex = 0;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[prevIndex]);\n            }\n\n            // End key.\n            if (e.keyCode === 35) {\n                var lastChooserOptionIndex = totalChooserOptions - 1;\n                if (index === lastChooserOptionIndex) {\n                    return;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[lastChooserOptionIndex]);\n            }\n\n            // Home key.\n            if (e.keyCode === 36) {\n                var firstChooserOptionIndex = 0;\n                if (index === firstChooserOptionIndex) {\n                    return;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[firstChooserOptionIndex]);\n            }\n\n            // Enter, space key.\n            if (e.keyCode === 13 || e.keyCode == 32) {\n\n                Object.values(SELECTORS.CHOOSER_OPTION_ACTIONS).forEach(chooserOptionActionElement => {\n                    $(chooserOptionActionElement).attr('tabindex', 0);\n                });\n                var addChooserOptionActionElement = $(this).find(SELECTORS.ADD_CHOOSER_OPTION);\n                $(addChooserOptionActionElement).focus();\n                $(this).attr('tabindex', -1);\n            }\n        });\n        listenevents.push(thisevent);\n\n        thisevent = $(SELECTORS.CHOOSER_OPTION_ACTION_GROUP_ELEMENT).on('keydown', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            var chooserOptionActions = $(this).closest(SELECTORS.CHOOSER_OPTION_ACTIONS_CONTAINER)\n                .find(SELECTORS.CHOOSER_OPTION_ACTION_GROUP_ELEMENT);\n            console.log(this);\n            console.log(chooserOptionActions);\n            var index = chooserOptionActions.index(this);\n\n            // Esc key.\n            if (e.keyCode === 27) {\n                var chooserOption = $(this).closest(SELECTORS.CHOOSER_OPTION_CONTAINER);\n                $(chooserOption).attr('tabindex', 0);\n                $(chooserOption).focus();\n                $(this).attr('tabindex', -1);\n            }\n\n            // Right key.\n            if (e.keyCode === 39) {\n                var nextIndex = index + 1;\n                if (typeof chooserOptionActions[nextIndex] === 'undefined') {\n                    return;\n                }\n                moveFocus(chooserOptionActions[index], chooserOptionActions[nextIndex]);\n            }\n\n            // Left key.\n            if (e.keyCode === 37) {\n                var prevIndex = index - 1;\n                if (typeof chooserOptions[prevIndex] === 'undefined') {\n                    return;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[prevIndex]);\n            }\n\n            // End key.\n            if (e.keyCode === 35) {\n                var lastChooserOptionIndex = totalChooserOptions - 1;\n                if (index === lastChooserOptionIndex) {\n                    return;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[lastChooserOptionIndex]);\n            }\n\n            // Home key.\n            if (e.keyCode === 36) {\n                var firstChooserOptionIndex = 0;\n                if (index === firstChooserOptionIndex) {\n                    return;\n                }\n                moveFocus(chooserOptions[index], chooserOptions[firstChooserOptionIndex]);\n            }\n\n            if (e.keyCode === 13) {\n                e.preventDefault();\n                e.stopPropagation();\n                if ($(this).parent().hasClass('showmodsummary')) {\n                    var chooserOptionSummary = $(this).closest(SELECTORS.MODULE_AREA)\n                        .find(SELECTORS.MODULE_SUMMARY_AREA);\n                    showOptionSummary(chooserOptionSummary);\n                }\n                return;\n            }\n        });\n        listenevents.push(thisevent);\n    };\n\n    var prepareChooser = function(sectionid) {\n        var body = bodycontent.detach();\n\n        // Stop the default event actions before we proceed.\n        return ModalFactory.create({\n            type: ModalFactory.types.DEFAULT,\n            body: body.html(),\n            title: headercontent.html(),\n            large: true\n        }).then(function(modal) {\n            modal.getRoot().on(ModalEvents.shown, function() {\n\n                // Find all anchors used to add an option and append the section param to the url.\n                var anchors = $(SELECTORS.CHOOSER_OPTION_CONTAINER).find(SELECTORS.ADD_CHOOSER_OPTION);\n                anchors.each(function(index, anchor) {\n                    anchor.href += '&section=' + sectionid;\n                });\n\n                var chooserOptions = $(SELECTORS.CHOOSER_OPTIONS_CONTAINER).find(SELECTORS.CHOOSER_OPTION_CONTAINER);\n                var firstChooserOption = chooserOptions[0];\n                $(firstChooserOption).attr(\"tabindex\", 0);\n\n                var moreInfoLinks = $(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTAINER).find('.helplinkpopup');\n                moreInfoLinks.each(function(key, moreInfoLink) {\n                    $(moreInfoLink).attr('tabindex', -1);\n                });\n\n                registerListenerEvents();\n            }.bind(this));\n\n            // We want to focus on the action select when the dialog is closed.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.getRoot().remove();\n            }.bind(this));\n\n\n            modal.show();\n\n            return modal;\n        });\n    };\n\n    /**\n      * Calculate the optimum height of the chooser dialogue\n      *\n      * This tries to set a sensible maximum and minimum to ensure that some options are always shown, and preferably\n      * all, whilst fitting the box within the current viewport.\n      *\n      * @method center_dialogue\n      * @param Node {dialogue} Y.Node The dialogue\n      */\n    var centerDialogue = function(dialogue) {\n        var bb = panel.get('boundingBox'),\n            winheight = bb.get('winHeight'),\n            newheight, totalheight;\n\n        if (panel.shouldResizeFullscreen()) {\n            // No custom sizing required for a fullscreen dialog.\n            return;\n        }\n\n        // Try and set a sensible max-height -- this must be done before setting the top\n        // Set a default height of 640px\n        newheight = ATTRS.maxheight;\n        if (winheight <= newheight) {\n            // Deal with smaller window sizes\n            if (winheight <= ATTRS.minheight) {\n                newheight = ATTRS.minheight;\n            } else {\n                newheight = winheight;\n            }\n        }\n\n        // If the dialogue is larger than a reasonable minimum height, we\n        // disable the page scrollbars.\n        if (newheight > ATTRS.minheight) {\n            // Disable the page scrollbars.\n            if (panel.lockScroll && !panel.lockScroll.isActive()) {\n                panel.lockScroll.enableScrollLock(true);\n            }\n        } else {\n            // Re-enable the page scrollbars.\n            if (panel.lockScroll && panel.lockScroll.isActive()) {\n                panel.lockScroll.disableScrollLock();\n            }\n        }\n\n        // Take off 15px top and bottom for borders, plus 40px each for the title and button area before setting the\n        // new max-height.\n        totalheight = newheight;\n        newheight = newheight - (15 + 15 + 40 + 40);\n        $(dialogue).css('maxHeight', newheight + 'px');\n\n        var dialogueheight = bb.getStyle('height');\n        if (dialogueheight.match(/.*px$/)) {\n            dialogueheight = dialogueheight.replace(/px$/, '');\n        } else {\n            dialogueheight = totalheight;\n        }\n\n        if (dialogueheight < ATTRS.baseheight) {\n            dialogueheight = ATTRS.baseheight;\n            $(dialogue).css('height', dialogueheight + 'px');\n        }\n\n        panel.centerDialogue();\n    };\n\n\n    var showOptionSummary = function(optionSummaryElement) {\n        // Get the current scroll position of the chooser container element.\n        var topPosition = $(SELECTORS.CHOOSER_CONTAINER).scrollTop();\n        // Get the height of the chooser container element.\n        var height = $(SELECTORS.CHOOSER_CONTAINER).outerHeight();\n        // Disable the scroll of the chooser container element.\n        $(SELECTORS.CHOOSER_CONTAINER).addClass('noscroll');\n\n        setOptionSummaryPositionAndHeight(optionSummaryElement, topPosition, height);\n\n        var optionSummaryContentElement = optionSummaryElement.find(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER);\n        // Set the scroll of the type summary content element to top.\n        if (optionSummaryContentElement.scrollTop() > 0) {\n            optionSummaryContentElement.scrollTop(0);\n        }\n        // Show the particular summary overlay.\n        optionSummaryElement.addClass('open');\n        var cancelAction = optionSummaryElement.find(SELECTORS.CLOSE_CHOOSER_OPTION_SUMMARY);\n        var addAction = optionSummaryElement.find(SELECTORS.ADD_MODULE);\n\n        $(cancelAction).attr('tabindex', 0);\n        $(addAction).attr('tabindex', 0);\n    };\n\n    var setOptionSummaryPositionAndHeight = function(optionSummaryElement, position, height) {\n        var optionSummaryContentElement = optionSummaryElement.find(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER);\n        var optionSumarryActionsElement = optionSummaryElement.find(SELECTORS.CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER);\n        var contentHeight = height - optionSumarryActionsElement.outerHeight();\n        optionSummaryContentElement.css({'height' : contentHeight + 'px'});\n\n        optionSummaryElement.css({'top' : position + 'px', 'height' : height + 'px'});\n    };\n\n    var moveFocus = function(fromElement, toElement) {\n        $(toElement).attr('tabindex', 0);\n        $(toElement).focus();\n        $(fromElement).attr('tabindex', -1);\n    };\n\n    /**\n      * Display the module chooser.\n      *\n      * @method display_chooser\n      * @param {EventFacade} e Triggering Event\n      */\n    var displayChooser = function(e, sectionid) {\n        prepareChooser(sectionid);\n    };\n\n    return /** @alias module:core/activity_chooser_dialogue */{\n\n        /**\n         * Poll the server for any new notifications.\n         *\n         * @method fetchNotifications\n         */\n        setupChooserDialogue: setupChooserDialogue,\n\n        /**\n         * Add a notification to the page.\n         *\n         * Note: This does not cause the notification to be added to the session.\n         *\n         * @method addNotification\n         * @param {Object}  notification                The notification to add.\n         * @param {string}  notification.message        The body of the notification\n         * @param {string}  notification.type           The type of notification to add (error, warning, info, success).\n         * @param {Boolean} notification.closebutton    Whether to show the close button.\n         * @param {Boolean} notification.announce       Whether to announce to screen readers.\n         */\n        displayChooser: displayChooser\n    };\n});\n"],"file":"activity_chooser_dialogue.min.js"}