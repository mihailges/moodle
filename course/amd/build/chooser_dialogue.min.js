define ("core_course/chooser_dialogue",["exports","jquery","core/modal_events","core_course/local/chooser/selectors","core/templates","core/key_codes","core/utils"],function(a,b,c,d,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.displayChooser=void 0;b=j(b);c=i(c);d=j(d);f=i(f);function i(a){if(a&&a.__esModule){return a}else{var b={};if(null!=a){for(var c in a){if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};if(d.get||d.set){Object.defineProperty(b,c,d)}else{b[c]=a[c]}}}}b.default=a;return b}}function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function l(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){k(h,d,e,f,g,"next",a)}function g(a){k(h,d,e,f,g,"throw",a)}f(void 0)})}}var m=function(){var a=l(regeneratorRuntime.mark(function a(b,c,e,g){var h,i,j,k,l,m;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:h=b.target.closest(d.default.regions.chooserOption.container);i=h.dataset.modname;a.next=4;return f.renderForPromise("core_course/chooser_help",c.get(i));case 4:j=a.sent;k=j.html;l=j.js;m=e.getBody()[0].querySelector(d.default.regions.help);a.next=10;return f.replaceNodeContents(m,k,l);case 10:g.carousel("next");g.carousel("pause");g.on("slid.bs.carousel",function(){var a=m.querySelector(d.default.regions.chooserSummary.description);a.focus()});case 13:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),n=function(a,c){var e=a.getBody()[0].querySelector(d.default.actions.search);a.getBody()[0].addEventListener("click",function(){var f=l(regeneratorRuntime.mark(function f(g){var h;return regeneratorRuntime.wrap(function(f){while(1){switch(f.prev=f.next){case 0:h=(0,b.default)(d.default.regions.carousel);h.carousel();h.off("keydown.bs.carousel");h.carousel("pause");if(!g.target.closest(d.default.actions.optionActions.showSummary)){f.next=7;break}f.next=7;return m(g,c,a,h);case 7:if(g.target.matches(d.default.actions.closeOption)){h.carousel("prev");h.on("slid.bs.carousel",l(regeneratorRuntime.mark(function a(){var b,c,e;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b=g.target.dataset.modname;c=document.querySelector(d.default.regions.modules);e=c.querySelector("[role=\"gridcell\"][data-modname=".concat(b,"]"));a.next=5;return e.focus();case 5:case"end":return a.stop();}}},a)})))}if(g.target.matches(d.default.actions.clearSearch)){e.value="";e.focus();r(a,c,e.value)}case 9:case"end":return f.stop();}}},f)}));return function(){return f.apply(this,arguments)}}());var f=a.getBody()[0].querySelector(d.default.regions.chooserOptions);o(a,c,f);e.addEventListener("input",(0,h.debounce)(function(){r(a,c,e.value)},300))},o=function(a,c,f){var h=f.querySelectorAll(d.default.regions.chooserOption.container);Array.from(h).forEach(function(e){return e.addEventListener("keyup",function(){var e=l(regeneratorRuntime.mark(function h(i){var e,j,k,l,n,o,q,r,s,t;return regeneratorRuntime.wrap(function(h){while(1){switch(h.prev=h.next){case 0:if(!(i.keyCode===g.enter||i.keyCode===g.space)){h.next=8;break}if(!i.target.matches(d.default.actions.optionActions.showSummary)){h.next=8;break}e=(0,b.default)(d.default.regions.carousel);e.carousel();e.off("keydown.bs.carousel");e.carousel("pause");h.next=8;return m(i,c,a,e);case 8:if(i.keyCode===g.arrowRight||i.keyCode===g.arrowDown){if(!i.target.matches(d.default.actions.optionActions.showSummary)){j=i.target.closest(d.default.regions.chooserOption.container);k=j.nextElementSibling;l=f.firstElementChild;p(k,l)}}if(i.keyCode===g.arrowLeft||i.keyCode===g.arrowUp){if(!i.target.matches(d.default.actions.optionActions.showSummary)){n=i.target.closest(d.default.regions.chooserOption.container);o=n.previousElementSibling;q=f.lastElementChild;p(o,q)}}if(i.keyCode===g.home){r=f.firstElementChild;r.focus()}if(i.keyCode===g.end){s=f.lastElementChild;s.focus()}if(i.keyCode===g.tab){if(i.target.matches(d.default.regions.chooserOption.container)&&i.target!==f.firstElementChild){t=a.getModal()[0].querySelector(d.default.actions.hide);t.focus()}}case 13:case"end":return h.stop();}}},h)}));return function(){return e.apply(this,arguments)}}())})},p=function(a,b){if(null!==a){a.focus()}else{b.focus()}},q=function(){var a=l(regeneratorRuntime.mark(function a(b,c,d){var e,g,h,i,j;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:e=c.length;g={searchresultsnumber:e,searchresults:c};a.next=4;return f.renderForPromise("core_course/chooser-search-results",g);case 4:h=a.sent;i=h.html;j=h.js;a.next=9;return f.replaceNodeContents(d,i,j);case 9:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),r=function(){var a=l(regeneratorRuntime.mark(function a(b,c,e){var f,g,h,i;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:f=0<e.length;g=b.getBody()[0].querySelector(d.default.regions.searchResults);if(!f){a.next=8;break}h=u(c,e);a.next=6;return q(b,h,g);case 6:i=g.querySelector(d.default.regions.searchResultItems);o(b,c,i);case 8:t(b,f);s(b,f);case 10:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),s=function(a,b){var c=a.getBody()[0].querySelector(d.default.actions.clearSearch);if(b){c.style.display="block"}else{c.style.display="none"}},t=function(a,b){var c=a.getBody()[0].querySelector(d.default.regions.searchResults),e=a.getBody()[0].querySelector(d.default.regions.chooserOptions);if(b){e.setAttribute("hidden","hidden");e.classList.remove("d-flex");c.removeAttribute("hidden")}else{c.setAttribute("hidden","hidden");e.removeAttribute("hidden");e.classList.add("d-flex")}},u=function(a,b){if(""===b){return a}b=b.toLowerCase();var c=[];a.forEach(function(a){var d=a.label.toLowerCase(),e=a.description.toLowerCase();if(d.includes(b)||e.includes(b)){c.push(a)}});return c},v=function(){var a=l(regeneratorRuntime.mark(function a(e,f,g){var h;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:h=new Map;g.forEach(function(a){h.set(a.modulename,a)});a.next=4;return n(f,h);case 4:f.getRoot().on(c.hidden,function(){try{var a=(0,b.default)(d.default.regions.carousel);a.carousel();a.carousel(0);e.focus()}catch(a){}});f.show();case 6:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.displayChooser=v});
//# sourceMappingURL=chooser_dialogue.min.js.map
