define ("core/activity_chooser_dialogue",["jquery","core/activity_chooser_events","core/local/aria/focuslock","core/modal_factory","core/modal_events","core/templates"],function(a,b,c,d,f,g){var h=function(){var b;while(listenevents.length){b=listenevents.shift();a(b).off()}},i={CHOOSER_CONTAINER:"[data-region=\"chooser-container\"]",CHOOSER_OPTIONS_CONTAINER:"[data-region=\"chooser-options-container\"]",CHOOSER_OPTION_CONTAINER:"[data-region=\"chooser-option-container\"]",CHOOSER_OPTION_ACTIONS_CONTAINER:"[data-region=\"chooser-option-actions-container\"]",CHOOSER_OPTION_INFO_CONTAINER:"[data-region=\"chooser-option-info-container\"]",CHOOSER_OPTION_SUMMARY_CONTAINER:"[data-region=\"chooser-option-summary-container\"]",CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER:"[data-region=\"chooser-option-summary-content-container\"]",CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER:"[data-region=\"chooser-option-summary-actions-container\"]",CHOOSER_OPTION_ACTION_GROUP_ELEMENT:"[data-group=\"chooser-option-action\"]",CHOOSER_OPTION_ACTIONS:{SHOW_CHOOSER_OPTION_SUMMARY:"[data-action=\"show-option-summary\"]"},ADD_CHOOSER_OPTION:"[data-action=\"add-chooser-option\"]",CLOSE_CHOOSER_OPTION_SUMMARY:"[data-action=\"close-chooser-option-summary\"]"},j=function(){document.querySelectorAll(i.CHOOSER_OPTION_ACTIONS.SHOW_CHOOSER_OPTION_SUMMARY).forEach(function(a){a.addEventListener("click",function(a){var b=a.target.closest(i.CHOOSER_OPTION_CONTAINER).querySelector(i.CHOOSER_OPTION_SUMMARY_CONTAINER);k(b)})});a(i.CLOSE_CHOOSER_OPTION_SUMMARY).on("click",function(b){var c=a(b.target).closest(i.CHOOSER_OPTION_CONTAINER).find(i.CHOOSER_OPTION_SUMMARY_CONTAINER);c.removeClass("open");a(i.CHOOSER_CONTAINER).removeClass("noscroll")});a(i.CHOOSER_OPTION_CONTAINER).on("keydown",function(b){var c=a(this).index(),d=a(i.CHOOSER_OPTIONS_CONTAINER).find(i.CHOOSER_OPTION_CONTAINER),e=d.length;if(39===b.keyCode||40===b.keyCode){var f=c+1;if("undefined"==typeof d[f]){return}a(d[f]).focus()}if(37===b.keyCode||38===b.keyCode){var g=c-1;if("undefined"==typeof d[g]){return}a(d[g]).focus()}if(35===b.keyCode){var h=e-1;if(c===h){return}a(d[h]).focus()}if(36===b.keyCode){if(c===0){return}a(d[0]).focus()}});a(i.CHOOSER_OPTION_ACTION_GROUP_ELEMENT).on("keydown",function(b){if(13===b.keyCode){if("show-option-summary"===a(this).data("action")){var c=a(this).closest(i.CHOOSER_OPTION_CONTAINER).find(i.CHOOSER_OPTION_SUMMARY_CONTAINER);k(c)}}})},k=function(b){var d=document.querySelector(i.CHOOSER_CONTAINER),e=d.scrollTop,f=d.offsetHeight;d.classList.add("noscroll");l(b,e,f);var g=b.querySelector(i.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER);if(0<g.scrollTop){g.scrollTop=0}b.classList.add("open");var h=b.querySelector(i.CLOSE_CHOOSER_OPTION_SUMMARY),j=b.querySelector(i.ADD_CHOOSER_OPTION);c.trapFocus(a(b));h.setAttribute("tabindex","0");j.setAttribute("tabindex","0")},l=function(a,b,c){console.log(a);var d=a.querySelector(i.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER),e=a.querySelector(i.CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER),f=c-e.offsetHeight;d.style.height=f+"px";a.style.top=b+"px";a.style.height=c+"px"};return{displayChooser:function displayChooser(b,c){return g.render("core_course/modchooser",c).then(function(e){return d.create({type:d.types.DEFAULT,body:e,title:c.title,large:!0}).then(function(c){c.getRoot().on(f.shown,function(){var b=a(i.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER).find("a");b.each(function(b,c){a(c).attr("tabindex",-1)});j()}.bind(this));c.getRoot().on(f.hidden,function(){a(b.target.closest(".chooser-link")).focus();c.getRoot().remove()}.bind(this));c.show()})})}}});
//# sourceMappingURL=activity_chooser_dialogue.min.js.map
