{"version":3,"sources":["../src/actions.js"],"names":["define","$","Str","Ajax","Notification","Url","ModalFactory","ModalEvents","InsightSelection","initBulk","rootNode","executeAction","predictionIds","actionName","call","methodname","args","predictionids","actionname","then","tableNode","forEach","predictionId","predictionTableRow","length","closest","remove","find","params","contextid","data","modelid","window","location","assign","relativeUrl","catch","exception","on","e","preventDefault","action","currentTarget","actionVisibleName","text","trim","toggleGroup","getSelectedPredictions","strings","get_strings","key","component","param","nitems","strs","create","type","types","SAVE_CANCEL","title","body","modal","setSaveButtonText","show","getRoot","save"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to manage report insights actions that are executed using AJAX.\n *\n * @package    report_insights\n * @copyright  2017 David Monllao {@link http://www.davidmonllao.com}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * This module manages prediction actions that require AJAX requests.\n *\n * @module report_insights/actions\n */\ndefine(['jquery',\n        'core/str',\n        'core/ajax',\n        'core/notification',\n        'core/url',\n        'core/modal_factory',\n        'core/modal_events',\n        'report_insights/insight_selection'],\n        function($, Str, Ajax, Notification, Url, ModalFactory, ModalEvents, InsightSelection) {\n\n    return {\n\n        /**\n         * Attach on click handlers for bulk actions.\n         *\n         * @param {String} rootNode\n         * @access public\n         */\n        initBulk: function(rootNode) {\n\n            /**\n             * Executes the provided action.\n             *\n             * @param  {Array}  predictionIds\n             * @param  {Array}  predictionContainers\n             * @param  {String} actionName\n             * @return {Promise}\n             */\n            var executeAction = function(predictionIds, actionName) {\n\n                return Ajax.call([\n                    {\n                        methodname: 'report_insights_action_executed',\n                        args: {\n                            predictionids: predictionIds,\n                            actionname: actionName\n                        }\n                    }\n                ])[0].then(function() {\n                    // Remove the selected elements from the list.\n\n                    var tableNode = false;\n\n                    predictionIds.forEach(function(predictionId) {\n                        var predictionTableRow = $('tr[data-prediction-id=\"' + predictionId + '\"]');\n                        if (!predictionTableRow.length) {\n                            return;\n                        }\n                        if (tableNode === false) {\n                            tableNode = predictionTableRow.closest('table');\n                        }\n                        predictionTableRow.remove();\n                    });\n\n                    if (tableNode.find('tbody > tr').length === 0) {\n                        let params = {\n                            contextid: tableNode.closest('div.insight-container').data('context-id'),\n                            modelid: tableNode.closest('div.insight-container').data('model-id')\n                        };\n                        window.location.assign(Url.relativeUrl(\"report/insights/insights.php\", params, false));\n                    }\n                    return;\n                }).catch(Notification.exception);\n            };\n\n            $(rootNode + ' [data-bulk-actionname]').on('click', function(e) {\n                e.preventDefault();\n                var action = $(e.currentTarget);\n                var actionName = action.data('bulk-actionname');\n                var actionVisibleName = action.text().trim();\n                var toggleGroup = action.data('togglegroup');\n                var predictionIds = InsightSelection.getSelectedPredictions(toggleGroup);\n\n                if (predictionIds === undefined || predictionIds.length === 0) {\n                    // No items selected message.\n                    return this;\n                }\n\n                var strings = [];\n                Str.get_strings([{\n                    key: 'confirmbulkaction',\n                    component: 'report_insights',\n                    param: {\n                        action: actionVisibleName,\n                        nitems: predictionIds.length\n                    }\n                }, {\n                    key: 'confirm',\n                    component: 'moodle'\n                }]\n                ).then(function(strs) {\n                    strings = strs;\n                    return ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: actionVisibleName,\n                        body: strings[0],\n                    });\n                }).then(function(modal) {\n                    modal.setSaveButtonText(strings[1]);\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.save, function() {\n                        // The action is now confirmed, sending an action for it.\n                        return executeAction(predictionIds, actionName);\n                    });\n\n                    return modal;\n                }).catch(Notification.exception);\n\n                return this;\n            });\n        },\n    };\n});\n"],"file":"actions.min.js"}